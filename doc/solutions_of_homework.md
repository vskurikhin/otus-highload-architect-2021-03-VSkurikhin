[![hits](https://hits.deltapapa.io/github/vskurikhin/otus-highload-architect-2021-03-VSkurikhin.svg)](https://hits.deltapapa.io)

# Домашняя работа

## TOC

- [Решение домашних заданий](solutions_of_homework.md)
  1. [Заготовка для социальной сети](solutions_of_homework.md#заготовка-для-социальной-сети)
  2. [Производительность индексов](solutions_of_homework.md#производительность-индексов)
  3. [Лента новостей социальной сети](solutions_of_homework.md#лента-новостей-социальной-сети)
  4. [Полусинхронная репликация](solutions_of_homework.md#полусинхронная-репликация)
  5. [In-Memory СУБД](solutions_of_homework.md#in-memory-субд)
  6. [Шардирование](homeworks.md#sharding)

### [Заготовка для социальной сети](solutions_of_homework.md#заготовка-для-социальной-сети)

Заготовка для социальной сети
Цель:
В результате выполнения ДЗ вы создадите базовый скелет социальной сети, который будет развиваться в дальнейших ДЗ. В данном задании тренируются навыки:

1. Проведена декомпозиции предметной области:\
   созданы таблицы:
   - login;
   - user;
   - interest;
   - user_has_interests.
1. Построенна архитектура проекта, состоящая из:\
   - БД (MySQL);
   - монолитного приложения (otus-highload-architect-2021-03-VSkurikhin);
   - UI на стороне web-браузера (JavaScript + React).

Требуется разработать создание и просмотр анект в социальной сети.

Реализованы функциональные требования:

1. Авторизация по паролю (API /login).
1. Страница регистрации (API /signin).
1. Страницa со списком пользователей (API /userlist).
1. Страницы с анкетой (API /userform/:id).

Нефункциональные требования:
- [x] Любой язык программирования
- [x] В качестве базы данных использовать MySQL
- [x] Не использовать ORM
- [x] Программа должна представлять из себя монолитное приложение.

Не рекомендуется использовать следующие технологии:

- [-] Репликация
- [-] Шардинг
- [-] Индексы
- [-] Кэширование

- [x] Разместить приложение на любом хостинге. Например, heroku:\
  [highload-architect](https://highload-architect.herokuapp.com)
- [x] ДЗ принимается в виде исходного кода на github и демонстрации проекта на хостинге:\
  бранч [homework/1](https://github.com/vskurikhin/otus-highload-architect-2021-03-VSkurikhin/tree/homework/1) на [github.com/vskurikhin/otus-highload-architect-2021-03-VSkurikhin](https://github.com/vskurikhin/otus-highload-architect-2021-03-VSkurikhin)

- [ ] Оценка происходит по принципу зачет/незачет.

### [Производительность индексов](homeworks.md#производительность-индексов)

В результате выполнения ДЗ вы создадите набор тестовых данных для проведения нагрузочного тестирования, подберете наиболее подходящие индексы и проведете тесты производительности. В данном задании тренируются навыки:

- [x] генерация тестовых данных;
- [x] работа с индексами;
- [x] нагрузочное тестирование;
- [x] Сгенерировать любым способ 1,000,000 анкет. Имена и Фамилии должны быть реальными (чтобы учитывать селективность индекса)
- [x] Реализовать функционал поиска анкет по префиксу имени и фамилии (одновременно) в вашей социальной сети (запрос в форме firstName LIKE ? and secondName LIKE ?). Сортировать вывод по id анкеты. Использовать InnoDB движок.
- [x] С помощью wrk провести нагрузочные тесты по этой странице. Поиграть с количеством одновременных запросов. 1/10/100/1000.
- [x] Построить графики и сохранить их в отчет
- [x] Сделать подходящий индекс.
- [x] Повторить пункт 3 и 4.
  В качестве результата предоставить отчет в котором должны быть:
- [x] графики latency до индекса;
- [x] графики throughput до индекса;
- [x] графики latency после индекса;
- [x] графики throughput после индекса;
- [x] запрос добавления индекса;
- [x] explain запросов после индекса;
- [x] объяснение почему индекс именно такой;
  ДЗ принимается в виде отчета по выполненной работе.

Критерии оценки:
Оценка происходит по принципу зачет/незачет.

Требования: Правильно выбраны индексы. Нагрузочное тестирование проведено и результаты адекватны.

Рекомендуем сдать до: 13.05.2021

### [Лента новостей социальной сети](homeworks.md#лента-новостей-социальной-сети)

Цель:
В результате выполнения ДЗ вы создадите ленту новостей социальной сети В данном задании тренируются навыки:

- [x] работа с кешами;
- [x] работа с очередями;
- [x] проектирование масштабируемых архитектур.
Разработать ленту новостей. Добавить функционал "добавление поста". Создается отдельная страница, куда пишутся все обновления друзей. Для этого нужно хранить подписчиков. Лента формируется на уровне кешей. Формирование ленты производить через постановку задачи в очередь на часть подписчиков, чтобы избежать эффекта леди Гаги. В ленте держать последние 1000 обновлений друзей. Лента должна кешироваться.

ДЗ сдается в виде ссылки на гитлаб и демонстрации работающего проекта, развернутого в интернете.

Критерии оценки:
Оценка происходит по принципу зачет/незачет.

Требования: Верно работает инвалидация кеша. Обновление лент работает через очередь. Есть возможность перестройки кешей из СУБД.

Рекомендуем сдать до: 25.05.2021

### [Полусинхронная репликация](solutions_of_homework.md#полусинхронная-репликация)

- [x] обеспечение отказоустойчивости проекта;
- [x] администрирование MySQL;
- [x] настройка репликации;
- [x] проведение нагрузочных тестов.
- [x] Настраиваем асинхронную репликацию.
- [x] Выбираем 2 любых запроса на чтения (в идеале самых частых и тяжелых по логике работы сайта) и переносим их на чтение со слейва.
- [x] Делаем нагрузочный тест по странице, которую перевели на слейв до и после репликации. Замеряем нагрузку мастера (CPU, la, disc usage, memory usage).

ОПЦИОНАЛЬНО: в качестве конфига, который хранит IP реплики сделать массив для легкого добавления реплики. Это не самый правильный способ балансирования нагрузки. Поэтому опционально.

- [x] Настроить 2 слейва и 1 мастер.
- [x] Включить row-based репликацию.
- [x] Включить GTID.
- [x] Настроить полусинхронную репликацию.
- [x] Создать нагрузку на запись в любую тестовую таблицу. На стороне, которой нагружаем считать, сколько строк мы успешно записали.
- [x] С помощью kill -9 убиваем мастер MySQL.
- [x] Заканчиваем нагрузку на запись.
- [x] Выбираем самый свежий слейв. Промоутим его до мастера. Переключаем на него второй слейв.
- [x] Проверяем, есть ли потери транзакций.

### [In-Memory СУБД](homeworks.md#in-memory-субд)

Репликация из MySQL в tarantool
Цель:
В результате выполнения ДЗ вы настроите репликацию из MySQL в tarantool, а также напишите запрос на lua. В данном задании тренируются навыки:
- [x] администрирование MySQL;
- [x] администрирование tarantool;
- [x] разработка хранимых процедур для tarantool.
- [x] Выбрать любую таблицу, которую мы читаем с реплик MySQL.
- [x] С помощью программы https://github.com/tarantool/mysql-tarantool-replication настроить реплицирование в tarantool (лучше всего версии 1.10).
- [x] Выбрать любой запрос и переписать его на lua-процедуру на tarantool.
- [x] Провести нагрузочное тестирование, сравнить tarantool и MySQL по производительности.

ДЗ сдается в виде ссылки на гитлаб и отчета о выполнении ДЗ.

Критерии оценки:

Оценка происходит по принципу зачет/незачет.

Требования: Репликация из MySQL в tarantool работает. Хранимые процедуры в tarantool написаны корректно. Хранимые процедуры выполнены по code style на примере репозитория Mail.Ru. Нагрузочное тестирование проведено.

Рекомендуем сдать до: 24.06.2021

### [Шардирование](homeworks.md#sharding)

Масштабируемая подсистема диалогов

Цель:
"В результате выполнения ДЗ вы создадите базовый скелет микросервиса, который будет развиваться в дальнейших ДЗ. В данном задании тренируются навыки:

- [x] декомпозиции предметной области;
- [x] построения элементарной архитектуры проекта"

Необходимо написать систему диалогов между пользователями. Обеспечить горизонтальное масштабирование хранилищ на запись с помощью шардинга. Предусмотреть:

- [x] Возможность решардинга
- [x] “Эффект Леди Гаги” (один пользователь пишет сильно больше среднего)
- [x] Наиболее эффективную схему.
ДЗ принимается в виде исходного кода на github и отчета по выполненной работе.

Критерии оценки:
Оценка происходит по принципу зачет/незачет.

Требования: Верно выбран ключ шардирования с учетом "эффекта Леди Гаги" В отчете описан процесс решардинга без даунтайма

Рекомендуем сдать до: 08.07.2021
